# =========================
# CONFIGURACIÓN DE PRODUCCIÓN
# =========================

# DataSource - Configuración de producción
spring.datasource.url=jdbc:postgresql://${DB_HOST_PROD}:${DB_PORT_PROD}/${DB_NAME_PROD}?sslmode=${DB_SSLMODE_PROD}
spring.datasource.username=${DB_USER_PROD}
spring.datasource.password=${DB_PASSWORD_PROD}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Connection Pool - Configuración para Neon PostgreSQL
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.connection-test-query=SELECT 1

# JPA - Configuración para producción (permite actualizaciones automáticas)
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.c3p0.timeout=300
spring.jpa.properties.hibernate.connection.autocommit=false

# Transaction Management - Configuración para producción
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true

# Flyway - DESHABILITADO (usando JPA auto-ddl)
spring.flyway.enabled=false

# GraphQL - Configuración pública para producción
spring.graphql.graphiql.enabled=true
spring.graphql.graphiql.path=/graphiql
spring.graphql.schema.introspection.enabled=true
spring.graphql.websocket.path=/graphql
spring.graphql.http.path=/graphql
spring.graphql.cors.allowed-origins=${CORS_ALLOWED_ORIGINS_PROD:http://localhost/}
spring.graphql.cors.allow-credentials=true

# Seguridad - Configuración estricta
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never
spring.web.resources.add-mappings=false

# Actuator - Solo endpoints esenciales
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never
management.endpoint.info.access=UNRESTRICTED
management.info.env.enabled=false

# Logging - Configuración optimizada para producción
logging.level.root=WARN
logging.level.com.petstore.backend=INFO
logging.level.org.springframework=WARN
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN
logging.level.org.postgresql=WARN
logging.level.org.flywaydb=INFO

# Patrón de logging optimizado para producción
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Configuración del servidor Tomcat para producción
server.tomcat.connection-timeout=20000
server.tomcat.max-connections=8192
server.tomcat.accept-count=100
server.tomcat.max-http-form-post-size=2MB
server.tomcat.threads.max=200
server.tomcat.threads.min-spare=10

# Configuración del servidor web
server.port=${PORT:8080}

# Compresión habilitada para producción
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Cache headers para recursos estáticos
spring.web.resources.cache.cachecontrol.max-age=31536000
spring.web.resources.cache.cachecontrol.cache-public=true

# Configuraciones adicionales de seguridad
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.same-site=strict
server.servlet.session.timeout=30m

# Deshabilitación de banners y salidas innecesarias
spring.main.banner-mode=off
spring.output.ansi.enabled=never

# Security whitelist específica para producción - Solo endpoints críticos
app.security.whitelist=/api/auth/login,/actuator/health,/graphql,/graphiql
